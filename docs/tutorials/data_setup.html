

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How to setup your data? &mdash; Aloception 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Training Detr" href="training_detr.html" />
    <link rel="prev" title="About augmented tensors" href="../getting_started/augmented_tensor.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Aloception
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Geting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/aloscene.html">Aloscene: Computer vision with ease</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/alodataset.html">Alodataset: Loading your vision datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/alonet.html">Alonet : Training your models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/augmented_tensor.html">About augmented tensors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Turorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to setup your data?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prepare-your-data">1. Prepare your data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#labels-settings">Labels settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-boxes-declaration">2D boxes declaration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frame-implementation">Frame implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basedataset-module">BaseDataset module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setup-a-custom-dataset-based-on-coco-json">2. Setup a custom dataset based on COCO JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-a-config-file">3. Make a config file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="training_detr.html">Training Detr</a></li>
<li class="toctree-l1"><a class="reference internal" href="finetuning_detr.html">Finetuning DETR</a></li>
<li class="toctree-l1"><a class="reference internal" href="training_panoptic.html">Training Panoptic Head module</a></li>
<li class="toctree-l1"><a class="reference internal" href="training_deformable_detr.html">Training Deformable DETR</a></li>
<li class="toctree-l1"><a class="reference internal" href="finetuning_deformable_detr.html">Finetuning Deformanble DETR</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensort_inference.html">Exporting DETR / Deformable-DETR to TensorRT</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Aloception API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aloscene/aloscene.html">Aloscene</a></li>
<li class="toctree-l1"><a class="reference internal" href="../alodataset/alodataset.html">Alodataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../alonet/alonet.html">Alonet</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Aloception</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>How to setup your data?</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/data_setup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="how-to-setup-your-data">
<h1>How to setup your data?<a class="headerlink" href="#how-to-setup-your-data" title="Permalink to this headline">¶</a></h1>
<p>This tutorial explains how to setup a custom dataset to train a deep model using <a class="reference internal" href="../index.html"><span class="doc">Aloception framework</span></a>.</p>
<div class="important admonition">
<p class="admonition-title">Goals</p>
<ol class="arabic simple">
<li><p>Prepare your data using <a class="reference internal" href="../aloscene/aloscene.html"><span class="doc">Aloscene</span></a> tools for 2D boxes prediction in classification tasks</p></li>
<li><p>Use a high-level tool in <a class="reference internal" href="../alodataset/alodataset.html"><span class="doc">Alodataset</span></a> to setup your data in <strong>COCO JSON</strong> format</p></li>
<li><p>Manually set up paths for multiple datasets.</p></li>
</ol>
</div>
<div class="section" id="prepare-your-data">
<h2>1. Prepare your data<a class="headerlink" href="#prepare-your-data" title="Permalink to this headline">¶</a></h2>
<p>Depending on the application, there are different ways of organizing the information. It is common, in
computer vision applications, to have a set of images to train, validate and/or test a model, as well as a set of
annotations about the important information to use in each image.
Several types of annotations allow to develop applications for detection, segmentation, interpretation and
verification of image content.</p>
<p>Therefore, it is reasonable to think of a data structure presented below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dataset
├── train
|   ├── img_train_0.jpg
|   ├── img_train_1.jpg
|   ├── ...
|   └── img_train_l.jpg
├── valid
|   ├── img_val_0.jpg
|   ├── img_val_1.jpg
|   ├── ...
|   └── img_val_m.jpg
├── test (optional)
|   ├── img_test_0.jpg
|   ├── img_test_1.jpg
|   ├── ...
|   └── img_test_n.jpg
└── annotations
    ├── ann_train
    |   ├── ann_img_train_0.txt
    |   ├── ann_img_train_1.txt
    |   ├── ...
    |   └── ann_img_train_l.txt
    └── ann_valid
        ├── ann_img_val_0.txt
        ├── ann_img_val_1.txt
        ├── ...
        └── ann_img_val_m.txt
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Recent database structures implement a single annotation file for each dataset. Examples are found in
<a class="reference external" href="https://roboflow.com/formats/coco-json">COCO JSON</a> or
<a class="reference external" href="https://roboflow.com/formats/tensorflow-object-detection-csv">Tensorflow Object Detection CSV</a>
formatted databases.</p>
</div>
<div class="section" id="labels-settings">
<span id="labels"></span><h3>Labels settings<a class="headerlink" href="#labels-settings" title="Permalink to this headline">¶</a></h3>
<p>In many object detection applications is necessary to classify each prediction made into different categories.
For this, the <a class="reference internal" href="../aloscene/labels.html"><span class="doc">Label</span></a> module in <a class="reference internal" href="../aloscene/aloscene.html"><span class="doc">Aloscene</span></a> provides one way to interpret the labels:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">aloscene</span> <span class="kn">import</span> <span class="n">Labels</span>

<span class="n">example_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">example_label_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;dog&quot;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">Labels</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">example_labels</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
    <span class="n">labels_names</span> <span class="o">=</span> <span class="n">example_label_names</span><span class="p">,</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span> <span class="c1"># Also, we can use &quot;one-hot&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In this example, we take an encoding by ID of three objects:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>person</strong> label with <strong>id = 0</strong></p></li>
<li><p><strong>cat</strong> label with <strong>id = 1</strong></p></li>
<li><p><strong>dog</strong> label with <strong>id = 2</strong></p></li>
</ol>
</div></blockquote>
<p>In additional, the first box should contain a <em>“person”</em>, the second one a <em>“cat”</em>, the third one a <em>“dog”</em>, and so on.
This corresponds to the order of the input tensor we assigned.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See <a class="reference internal" href="../aloscene/labels.html"><span class="doc">Label</span></a> for more information of its properties and attributes.</p>
</div>
</div>
<div class="section" id="d-boxes-declaration">
<h3>2D boxes declaration<a class="headerlink" href="#d-boxes-declaration" title="Permalink to this headline">¶</a></h3>
<p>On the other hand, <a class="reference internal" href="../aloscene/aloscene.html"><span class="doc">Aloscene</span></a> implements a module to handled the boxes. This module is called
<a class="reference internal" href="../aloscene/bounding_boxes_2d.html"><span class="doc">BoundingBoxes2D</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">aloscene</span> <span class="kn">import</span> <span class="n">BoundingBoxes2D</span>

<span class="n">random_boxes</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>

<span class="c1"># First option</span>
<span class="n">boxes</span> <span class="o">=</span> <span class="n">BoundingBoxes2D</span><span class="p">(</span>
    <span class="n">random_boxes</span><span class="p">,</span>
    <span class="n">boxes_format</span><span class="o">=</span><span class="s2">&quot;xcyc&quot;</span><span class="p">,</span>
    <span class="n">absolute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
<span class="p">)</span>

<span class="c1"># Second option</span>
<span class="n">boxes</span> <span class="o">=</span> <span class="n">BoundingBoxes2D</span><span class="p">(</span>
    <span class="n">random_boxes</span><span class="p">,</span>
    <span class="n">boxes_format</span><span class="o">=</span><span class="s2">&quot;xcyc&quot;</span><span class="p">,</span>
    <span class="n">absolute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">boxes</span><span class="o">.</span><span class="n">append_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
<p>For the example, a random boxes set were implement with normalized values, (x_center, y_center, width, height)
as coordinates configuration and labels defined in <a class="reference internal" href="#labels"><span class="std std-ref">Labels settings</span></a> section.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If labels are decided, <strong>labels.size(0) == boxes.size(0)</strong>.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See <a class="reference internal" href="../aloscene/bounding_boxes_2d.html"><span class="doc">BoundingBoxes2D</span></a> for more information.</p>
</div>
</div>
<div class="section" id="frame-implementation">
<span id="setup-custom-dataset"></span><h3>Frame implementation<a class="headerlink" href="#frame-implementation" title="Permalink to this headline">¶</a></h3>
<p>Given the possibility of that one frame can have multiple boxes, <a class="reference internal" href="../aloscene/frame.html"><span class="doc">Frame</span></a> module has an attribute called
<code class="xref py py-attr docutils literal notranslate"><span class="pre">boxes2d</span></code>. For a random image, we could use <a class="reference internal" href="../aloscene/frame.html"><span class="doc">Frame</span></a> as follows for the previous boxes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">aloscene</span> <span class="kn">import</span> <span class="n">Frame</span>

<span class="n">image_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span> <span class="c1"># A random image size</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">image_size</span><span class="p">),</span>
    <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">),</span>
    <span class="n">boxes2d</span><span class="o">=</span><span class="n">boxes</span><span class="p">,</span>
    <span class="n">normalization</span><span class="o">=</span><span class="s2">&quot;01&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>There are many ways to interpret the information in an image, but for purpose of this tutorial, we just implemented the boxes2d.
See <a class="reference internal" href="../aloscene/frame.html"><span class="doc">Frame</span></a> to read more about them.</p>
</div>
</div>
<div class="section" id="basedataset-module">
<h3>BaseDataset module<a class="headerlink" href="#basedataset-module" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../alodataset/base_dataset.html"><span class="doc">Base dataset</span></a> is a module based on <a class="reference external" href="https://pytorch.org/docs/stable/data.html#dataset-types">pytorch dataset class</a>. It is able to handled a dataset <strong>based on its root directory</strong>.
For this, it saves the root directory in one configuration file named <strong>aloception_config.json</strong>, saved in <strong>$HOME/.aloception</strong> folder.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If <a class="reference internal" href="../alodataset/base_dataset.html"><span class="doc">Base dataset</span></a> module is used, <em>aloception_config.json</em> and <strong>$HOME/.aloception</strong> folder
will be created automatically. However, <a class="reference internal" href="#setup-multiples-datasets"><span class="std std-ref">3. Make a config file</span></a> section shows more details about that.</p>
</div>
<p>A general use of the module would be described by the following scheme of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">alodataset</span> <span class="kn">import</span> <span class="n">BaseDataset</span>
<span class="kn">from</span> <span class="nn">aloscene</span> <span class="kn">import</span> <span class="n">Frame</span><span class="p">,</span> <span class="n">BoundingBoxes2D</span><span class="p">,</span> <span class="n">Labels</span>

<span class="k">class</span> <span class="nc">CustomDataset</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ann_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">image_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ann_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">ann_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_image_ann</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_folder</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_match_image_ann</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_folder</span><span class="p">,</span> <span class="n">ann_folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TODO: Perform a function to match each image with theirs annotations.</span>
<span class="sd">        A minimal example could be the below: &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">image_folder</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">ann_folder</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_load_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Frame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;TODO: Load the image corresponds to &#39;id&#39; input from &#39;self.image_folder&#39;.</span>
<span class="sd">        Use self.items attribute! &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_load_ann</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoundingBoxes2D</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;TODO: Load the annotations corresponds to &#39;id&#39; input from &#39;self.ann_folder&#39;.</span>
<span class="sd">        Use self.items attribute! &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Frame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;TODO: Load the image corresponds to &#39;id&#39; input from &#39;self.image_folder&#39;&quot;&quot;&quot;</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_image</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">boxes2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_ann</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">append_boxes2d</span><span class="p">(</span><span class="n">boxes2d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">frame</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">CustomDataset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_dataset&quot;</span><span class="p">,</span>
    <span class="n">image_folder</span><span class="o">=</span><span class="s2">&quot;path/image/folder&quot;</span><span class="p">,</span>
    <span class="n">ann_folder</span><span class="o">=</span><span class="s2">&quot;path/annotation/folder&quot;</span><span class="p">,</span>
    <span class="n">transform_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span> <span class="c1"># Fake transform to give one example</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">stream_loader</span><span class="p">():</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>There are many key concepts in <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseDataset</span></code> class:</p>
<ul class="simple">
<li><p>We recommend to use <code class="xref py py-attr docutils literal notranslate"><span class="pre">self.dataset_dir</span></code> attribute to get the dataset root folder. Also, we should define all the paths as relative from it.</p></li>
<li><p>All information required about each element in dataset will have to be given by <code class="xref py py-func docutils literal notranslate"><span class="pre">getitem()</span></code> function.</p></li>
<li><p>By default, the dataset size is given by <code class="xref py py-attr docutils literal notranslate"><span class="pre">len(self.items)</span></code>.</p></li>
<li><p>Use <code class="xref py py-func docutils literal notranslate"><span class="pre">stream_loader()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">train_loader()</span></code> to get individual samples or batch samples, respectively.</p></li>
</ul>
</div>
<p>If an application must handled several datasets (like train, valid, test sets), we recommend using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">alodataset.SplitMixin</span></code> module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">alodataset</span> <span class="kn">import</span> <span class="n">Split</span><span class="p">,</span> <span class="n">SplitMixin</span>

<span class="k">class</span> <span class="nc">CustomDatasetSplitMix</span><span class="p">(</span><span class="n">CustomDataset</span><span class="p">,</span> <span class="n">SplitMixin</span><span class="p">):</span>

    <span class="c1"># Mandatory parameter with relative paths</span>
    <span class="n">SPLIT_FOLDERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Split</span><span class="o">.</span><span class="n">VAL</span> <span class="p">:</span> <span class="s2">&quot;val2017&quot;</span><span class="p">,</span>
        <span class="n">Split</span><span class="o">.</span><span class="n">TRAIN</span> <span class="p">:</span> <span class="s2">&quot;train2017&quot;</span><span class="p">,</span>
        <span class="n">Split</span><span class="o">.</span><span class="n">TEST</span> <span class="p">:</span> <span class="s2">&quot;test2017&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="n">Split</span> <span class="o">=</span> <span class="n">Split</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CustomDatasetSplitMix</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_split_folder</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ann_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ann_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_split_folder</span><span class="p">())</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">CustomDataset</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_dataset&quot;</span><span class="p">,</span>
    <span class="n">image_folder</span><span class="o">=</span><span class="s2">&quot;path/image/folder&quot;</span><span class="p">,</span>
    <span class="n">ann_folder</span><span class="o">=</span><span class="s2">&quot;path/annotation/folder&quot;</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="n">Split</span><span class="o">.</span><span class="n">VAL</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CustomDatasetSplitMix could be developped in one class that used BaseDataset and SplitMixin classes.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseDataset</span></code> class is based on <a class="reference external" href="pytorchdatasetclass">torch.utils.data.Dataset</a> module. All information
is provided in <a class="reference internal" href="../alodataset/base_dataset.html"><span class="doc">Base dataset</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="setup-a-custom-dataset-based-on-coco-json">
<h2>2. Setup a custom dataset based on COCO JSON<a class="headerlink" href="#setup-a-custom-dataset-based-on-coco-json" title="Permalink to this headline">¶</a></h2>
<p>Many <strong>COCO JSON</strong> formatted datasets are available on the Internet. For example, <a class="reference external" href="https://public.roboflow.com/">roboflow</a> provides several labeled and
configured datasets for implementation in machine learning applications. Also, there are many examples of how to setup
a dataset using <strong>COCO JSON</strong> format. <a class="reference external" href="https://www.immersivelimit.com/tutorials/create-coco-annotations-from-scratch">Create COCO Annotations From Scratch</a>
page explains how to make this work <em>manually</em>. Some tools is able to make and sort the annotation, like <a class="reference external" href="https://roboflow.com/#annotate">roboflow annotations</a>.</p>
<p>As a database handled tool on <a class="reference external" href="https://pytorch.org/">pytorch</a> for object detection applications, <a class="reference internal" href="../index.html"><span class="doc">Aloception’s documentation</span></a> offers a quick
configuration module on top of this type of database: <a class="reference internal" href="../alodataset/coco_detection_dataset.html"><span class="doc">Coco detection</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For this part of the tutorial, <a class="reference external" href="https://cocodataset.org/#detection-2017">COCO 2017 detection dataset</a> was used as a custom dataset. On the other hand, we assumed that
the dataset was downloaded and stored in <strong>$HOME/data/coco</strong> directory. However, it is possible used a datataset based on
<strong>COCO JSON</strong> format changing <code class="xref py py-attr docutils literal notranslate"><span class="pre">img_folder</span></code> and <code class="xref py py-attr docutils literal notranslate"><span class="pre">ann_file</span></code> paths.</p>
</div>
<p>For <a class="reference external" href="https://cocodataset.org/#detection-2017">COCO 2017 detection dataset</a>, the <em>valid</em> dataset can be implemented by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">alodataset</span> <span class="kn">import</span> <span class="n">CocoDetectionDataset</span>

<span class="n">coco_dataset</span> <span class="o">=</span> <span class="n">CocoDetectionDataset</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;coco&quot;</span><span class="p">,</span> <span class="c1"># Parameter by default, change for others datasets</span>
    <span class="n">img_folder</span> <span class="o">=</span> <span class="s2">&quot;val2017&quot;</span><span class="p">,</span>
    <span class="n">ann_file</span> <span class="o">=</span> <span class="s2">&quot;annotations/instances_val2017.json&quot;</span><span class="p">,</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;valid&quot;</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">stream_loader</span><span class="p">():</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>
</div>
<p>Now the module could read and process the images <a class="reference external" href="coco">COCO2017 detection valid set</a>.</p>
<p>If a speed setup is required, we could use <code class="xref py py-attr docutils literal notranslate"><span class="pre">sample</span></code> attribute, without having to download the data set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coco_dataset</span> <span class="o">=</span> <span class="n">CocoDetectionDataset</span><span class="p">(</span><span class="n">sample</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="xref py py-attr docutils literal notranslate"><span class="pre">sample</span></code> feature only applies to datasets managed by <a class="reference internal" href="../alodataset/alodataset.html"><span class="doc">Alodataset</span></a></p>
</div>
</div>
<div class="section" id="make-a-config-file">
<span id="setup-multiples-datasets"></span><h2>3. Make a config file<a class="headerlink" href="#make-a-config-file" title="Permalink to this headline">¶</a></h2>
<p>All modules based on <code class="xref py py-mod docutils literal notranslate"><span class="pre">BaseDataset</span></code> will execute a user prompt after the execution of its declaration if the root directory
of the database does not exist in <strong>aloception_config.json</strong> file. However, it might be useful to think about configuring this file
for multiple datasets.</p>
<p>First, we need to create the <strong>aloception_config.json</strong> in <strong>$HOME/.aloception</strong> directory. This file must contain the following information:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;dataset_name_1&quot;</span><span class="p">:</span> <span class="s2">&quot;paht/of/dataset_1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;dataset_name_2&quot;</span><span class="p">:</span> <span class="s2">&quot;paht/of/dataset_2&quot;</span><span class="p">,</span>
    <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="nt">&quot;dataset_name_n&quot;</span><span class="p">:</span> <span class="s2">&quot;paht/of/dataset_n&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An example could be:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;coco&quot;</span><span class="p">:</span> <span class="s2">&quot;$HOME/data/coco&quot;</span><span class="p">,</span>
    <span class="nt">&quot;rabbits&quot;</span><span class="p">:</span> <span class="s2">&quot;/data/rabbits&quot;</span><span class="p">,</span>
    <span class="nt">&quot;pascal2012&quot;</span><span class="p">:</span> <span class="s2">&quot;/data/pascal&quot;</span><span class="p">,</span>
    <span class="nt">&quot;raccoon&quot;</span><span class="p">:</span> <span class="s2">&quot;$HOME/data/raccon&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With this pre-set up, the reading of the directory will be done automatically according to the <code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code> value.</p>
<div class="note admonition">
<p class="admonition-title">What is next ?</p>
<p>Learn how to train a model using your custom data in <a class="reference internal" href="training_detr.html"><span class="doc">Training Detr</span></a> and <a class="reference internal" href="training_deformable_detr.html"><span class="doc">Training Deformable DETR</span></a>
tutorials.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="training_detr.html" class="btn btn-neutral float-right" title="Training Detr" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../getting_started/augmented_tensor.html" class="btn btn-neutral float-left" title="About augmented tensors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Visual Behavior.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>